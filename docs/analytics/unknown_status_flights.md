# Investigating Unknown `status_detail`

## Queries Check

```postgresql
-- Pull a quick profile to see whether these flights are still on the ground or entirely missing real‑time data
SELECT                                                                                                                                                                                                                                                                                                                                                           
        COUNT(*) AS total_unknown,                                                                                                                                                                                                                                                                                                                                   
        SUM(CASE WHEN real_dep IS NULL THEN 1 ELSE 0 END) AS no_real_dep,                                                                                                                                                                                                                                                                                            
        SUM(CASE WHEN real_arr IS NULL THEN 1 ELSE 0 END) AS no_real_arr                                                                                                                                                                                                                                                                                             
    FROM public.flights_commercial                                                                                                                                                                                                                                                                                                                                   
    WHERE status_detail = 'Unknown';

-- Check which carriers and destinations dominate “Unknown” to spot systemic feed gaps
SELECT airline_iata, dest_iata, COUNT(*) AS flights                                                                                                                                                                                                                                                                                                              
    FROM public.flights_commercial                                                                                                                                                                                                                                                                                                                                   
    WHERE status_detail = 'Unknown'                                                                                                                                                                                                                                                                                                                                  
    GROUP BY airline_iata, dest_iata                                                                                                                                                                                                                                                                                                                                 
    ORDER BY flights DESC                                                                                                                                                                                                                                                                                                                                            
    LIMIT 20;

-- Examine timing to see if it clusters around very early schedules or outdated snapshots
SELECT                                                                                                                                                                                                                                                                                                                                                           
        TO_CHAR(TO_TIMESTAMP(sched_dep), 'YYYY-MM-DD HH24:MI') AS scheduled_dep,                                                                                                                                                                                                                                                                                     
        COUNT(*) AS flights                                                                                                                                                                                                                                                                                                                                          
    FROM public.flights_commercial                                                                                                                                                                                                                                                                                                                                   
    WHERE status_detail = 'Unknown'                                                                                                                                                                                                                                                                                                                                  
    GROUP BY TO_CHAR(TO_TIMESTAMP(sched_dep), 'YYYY-MM-DD HH24:MI')                                                                                                                                                                                                                                                                                                  
    ORDER BY flights DESC                                                                                                                                                                                                                                                                                                                                            
    LIMIT 20;

-- If you want raw examples for manual inspection, grab a handful with all context:
SELECT flight_num, airline, origin_iata, dest_iata,                                                                                                                                                                                                                                                                                                              
           sched_dep, real_dep, status_detail                                                                                                                                                                                                                                                                                                                        
    FROM public.flights_commercial                                                                                                                                                                                                                                                                                                                                   
    WHERE status_detail = 'Unknown'                                                                                                                                                                                                                                                                                                                                  
    ORDER BY sched_dep DESC                                                                                                                                                                                                                                                                                                                                          
    LIMIT 50;
```

## Analysis Reason
- **All 5,677 Unknown rows lack** `real_dep`/`real_arr` (`public.flights_commercial`: all counts in `no_real_dep`/`no_real_arr equal` the total), so the live feed hasn’t recorded an actual event yet.                                                                                                                                                                          
- **Most are far in the future** (top schedules are in late October–November 2025), which suggests they’re still “planned only” flights; FlightRadar often emits “Unknown” for long-horizon schedules that haven’t moved into day-of operations.                                                                                                                       
- **Dominant carriers/destinations** (OC→FUK, AQ→KWE/CAN, TI→NSB, 8L→KMG, etc.) are mostly non‑US airlines despite the US-origin filter because those carrier codes operate out of US territories via partner data, and they also tend to publish extended schedules. Combined with the lack of any `real_dep`, it indicates the ingestion is capturing future schedules 
  but the provider hasn’t classified them yet. 

## Analytics/Reporting Usage
- Bucket them explicitly: keep a distinct “Unknown/Pending” status so you don’t inflate “Cancelled” or “Scheduled” counts. In dashboards, show it alongside Scheduled/Departed so stakeholders can see how much of the pipeline still lacks updates.                                                                                                               
  - Derive fallback statuses: if you need deterministic categories, create a derived column (e.g., `derived_status`) that maps:                                                                                                                                                                                                                                        
      1. `status_detail='Cancelled'` → Cancelled,                                                                                                                                                                                                                                                                                                                      
      2. `real_dep IS NOT NULL` → Departed,                                                                                                                                                                                                                                                                                                                            
      3. `real_arr IS NOT NULL` → Arrived,                                                                                                                                                                                                                                                                                                                             
      4. else `status_detail` (which might be “Scheduled,” “Delayed,” etc.),                                                                                                                                                                                                                                                                                           
      5. default to “Pending” when the raw text is NULL/“Unknown.”                                                                                                                                                                                                                                                                                                   
  - Alerts/QA: monitor “Unknown” counts as flights approach scheduled departure. If a flight stays Unknown within, say, 1 hour of `sched_dep`, flag it for investigation since that often indicates a feed gap.                                                                                                                                                        
  - Downstream logic: when consumers need to make go/no-go decisions, treat Unknown as “assume scheduled unless you hear otherwise.” Only escalate to Cancelled when the upstream text says so or you have other proof (e.g., airline API).